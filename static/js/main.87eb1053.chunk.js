(this.webpackJsonpfacial_recognition=this.webpackJsonpfacial_recognition||[]).push([[0],{35:function(e,t,n){},37:function(e,t,n){},45:function(e,t){},46:function(e,t){},47:function(e,t){},59:function(e,t,n){"use strict";n.r(t);var s=n(3),a=n.n(s),c=n(17),i=n.n(c),r=(n(35),n(6)),o=n(5),l=n.n(o),d=n(9),u=n(8),b=n(4),j=(n(37),n(38),n(12)),g=n(72),m=n(73),h=n(27),x=n.n(h),f=n(2),p=function(e){var t=a.a.useRef(null),n=Object(s.useState)(null),c=Object(b.a)(n,2),i=c[0],r=c[1];Object(s.useEffect)((function(){null!=i&&e.addImage(i)}),[i]);var o=a.a.useCallback((function(){var e=t.current.getScreenshot();r(e)}),[t]);return Object(f.jsxs)("div",{id:"webcamModal",className:"d-inline-flex justify-content-center shadow position-absolute top-50 start-50 translate-middle",style:{position:"relative"},children:[Object(f.jsx)(x.a,{style:{borderRadius:"15px",zIndex:12},mirrored:!0,audio:!1,ref:t,screenshotFormat:"image/jpeg"}),Object(f.jsxs)("div",{className:"text-white position-absolute top-50 start-50 translate-middle",style:{zIndex:11},children:["Loading"," ",Object(f.jsx)("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})]}),Object(f.jsx)("button",{onClick:function(){return o()},className:"btn btn-success "+(e.processing?"disabled":""),style:{position:"absolute",bottom:"10px",zIndex:13},children:0==e.processing?Object(f.jsxs)(f.Fragment,{children:["Capture photo ",Object(f.jsx)(g.a,{})]}):Object(f.jsxs)(f.Fragment,{children:["processing"," ",Object(f.jsx)("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})]})}),Object(f.jsx)("button",{style:{position:"absolute",top:"10px",right:"10px",zIndex:13},onClick:function(){e.closeWebcam()},className:"btn btn-danger",children:Object(f.jsx)(m.a,{})})]})},O=n(15),v=function(e){return Object(f.jsxs)("div",{style:{display:"inline-flex"},children:[Object(f.jsx)("label",{className:e.input_id+"Label col-12",htmlFor:e.input_id,children:e.children},e.input_id),Object(f.jsx)("input",{id:e.input_id,style:{display:"none"},name:e.input_id,type:"file",accept:"image/*",onClick:function(e){e.target.value="",console.log(e.target.files)},onChange:function(t){if(e.modelLoaded){var n=URL.createObjectURL(t.target.files[0]);console.log(t.target.files),e.addImage(n,e.target)}}})]})},y=n(20),w=n.n(y),I=n.p+"static/media/stockperson.ee28a91d.png",k=function(e){return Object(f.jsxs)("div",{id:"faceGrid",className:"row mx-0 col-12 justify-content-center",children:[Object(f.jsx)("div",{className:"d-flex bg-light shadow my-2 mx-2 px-0",style:{backgroundImage:"url("+I+")"}}),Object(f.jsx)("div",{className:"d-flex bg-light text-dark text-center shadow my-2 mx-2 px-0",style:{backgroundImage:"url("+I+")"},children:Object(f.jsx)("div",{className:"d-flex muted px-0 align-items-center bd-blur",style:{fontWeight:"bold"},children:"Add Images to see faces here"})}),Object(f.jsx)("div",{className:"d-flex bg-light shadow my-2 mx-2 px-0",style:{backgroundImage:"url("+I+")"}})]})},N=function(e){return 0==e.images.length?Object(f.jsx)(k,{}):Object(f.jsx)("div",{id:"referenceGrid",className:"row mx-0 justify-content-center px-2",children:e.images.map((function(t,n){var s;return Object(f.jsxs)("div",{className:"my-2 mx-2 shadow px-0  "+(e.active==n?"activeGrid":"inactiveGrid"),children:[Object(f.jsx)(w.a,{style:{position:"absolute",top:"7.5px",right:"7.5px",color:"white",cursor:"pointer"},onClick:function(){e.active>0&&e.active>=n&&e.setActive(e.active-1),1==e.images.length&&e.setActive(-1),e.removeImage(n)}}),Object(f.jsx)("img",(s={className:"shadow position-absolute top-50 start-50 translate-middle",src:t},Object(O.a)(s,"className",e.active==n?"activeGridImg":"inactiveGridImg"),Object(O.a)(s,"onClick",(function(){e.setActive(n)})),s))]})}))})},R=n(74),S=n(75),C=function(e){return Object(f.jsxs)("div",{className:"btn-group pb-2",children:[Object(f.jsx)(v,{addImage:e.handleFileInput,target:e.target,modelLoaded:e.modelLoaded,input_id:e.target+"Image",children:Object(f.jsxs)("div",{className:"col-12 btn btn-success",style:{borderTopRightRadius:"0px",borderBottomRightRadius:"0px"},children:[Object(f.jsx)(R.a,{})," from file"]})}),Object(f.jsx)("button",{className:"col btn btn-success disabled",children:e.label}),Object(f.jsxs)("button",{className:"col btn btn-success",onClick:function(){e.webcamFunction(!0)},children:["webcam ",Object(f.jsx)(S.a,{})]})]})},F=function(e){return Object(f.jsxs)("div",{id:"faceGrid",className:"row mx-0 col-12 justify-content-center",children:[Object(f.jsx)("div",{className:"d-flex bg-light shadow my-2 mx-2 px-0",style:{backgroundImage:"url("+I+")"}}),Object(f.jsx)("div",{className:"d-flex bg-light text-dark text-center shadow my-2 mx-2 px-0",style:{backgroundImage:"url("+I+")"},children:Object(f.jsx)("div",{className:"d-flex muted px-0 align-items-center bd-blur",style:{fontWeight:"bold"},children:"Add Images to see faces here"})}),Object(f.jsx)("div",{className:"d-flex bg-light shadow my-2 mx-2 px-0",style:{backgroundImage:"url("+I+")"}})]})},L=function(e){return 0==e.images.length?Object(f.jsx)(F,{}):Object(f.jsx)("div",{id:"faceGrid",className:"row mx-0 justify-content-center px-2",children:e.images.map((function(t,n){return Object(f.jsxs)("div",{className:"my-2 mx-2 shadow px-0",children:[Object(f.jsx)(w.a,{style:{position:"absolute",top:"7.5px",right:"7.5px",color:"white",cursor:"pointer"},onClick:function(){e.removeImage(n)}}),Object(f.jsx)("img",{src:t})]})}))})},E=function(e){return-1!=e.index?Object(f.jsxs)("div",{children:[Object(f.jsx)("img",{className:"d-inline-flex",width:"180px",height:"320px",style:{borderRadius:"15px"},src:e.images[e.index]}),Object(f.jsx)("div",{className:"text-center",children:"Reference Image"})]}):Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"d-inline-flex",style:{borderRadius:"15px",backgroundImage:"url("+I+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"320px",width:"180px"},src:e.images[e.index],children:Object(f.jsx)("div",{className:"d-flex bd-blur shadow text-dark bold text-center justify-content-center align-items-center",style:{height:"320px",width:"180px",fontWeight:"bold"},children:e.que})})})},_=function(e){return 0==e.progressStatus.createDatabase.status||0==e.progressStatus.uploadReferenceImage.status?Object(f.jsx)("div",{className:"btn btn-danger disabled",children:"Complete Steps 1 & 2 to Match Results"}):0==e.progressStatus.results.status?Object(f.jsx)("button",{onClick:function(){return e.startQuery()},children:"Check For Matches"}):e.foundFace?Object(f.jsx)("button",{className:"btn btn-success",onClick:function(){return e.startQuery()},children:"Found a Match"}):e.inProgress?Object(f.jsx)("button",{className:"btn btn-success",children:" Loading"}):Object(f.jsx)("button",{className:"btn btn-danger",children:"No Face Found"})},M=function(e){var t=Object(s.useState)(!1),n=Object(b.a)(t,2),a=n[0],c=n[1],i=Object(s.useState)(!1),r=Object(b.a)(i,2),o=r[0],l=r[1],d=Object(s.useState)(null),u=Object(b.a)(d,2);u[0],u[1];return Object(s.useEffect)((function(){if(0!=e.image){c(e.image.image);var t=document.getElementById("faceImage");t.crossOrigin="Anonymous",t.src=e.image.image,t.onload=function(){var n=t.naturalWidth,s=t.naturalHeight;console.log(s);var a=[e.image.coordinates[0]+e.image.coordinates[2]/2,e.image.coordinates[1]+e.image.coordinates[3]/2],c=Math.floor(e.localDimensions[1]/160);console.log(c);var i=Math.floor(c*a[1]/s-1)*c+Math.floor(c*a[0]/n);console.log(i),l(i),console.log(e),console.log(i)}}else 0==e.image&&c(!1)}),[e.image]),Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("div",{className:"shadow",style:{position:"absolute",width:"180px",height:"320px",display:"block",background:"url("+(o?e.faces[o]:"")+")",backgroundRepeat:"no-repeat",backgroundSize:"cover",borderRadius:"15px"}}),Object(f.jsx)("img",{id:"faceImage",style:{display:"none"}}),Object(f.jsx)("img",{id:"matchedImage",style:{position:"fixed",borderRadius:"15px",display:"none"},src:a}),a?Object(f.jsxs)("div",{className:"col-12 row mx-0 justify-content-center align-items-center",children:[Object(f.jsx)("div",{className:"col-12 row mx-0 justify-content-center",children:Object(f.jsx)("canvas",{id:"faceCanvas",className:"mx-0 px-0 my-0",style:{width:e.image.coordinates[2]+"px",height:e.image.coordinates[3]+"px"}})}),Object(f.jsx)("div",{className:"col-12 text-center",children:"Matched Imaged"})]}):Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"d-inline-flex",style:{borderRadius:"15px",backgroundImage:"url("+I+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:"320px",width:"180px"},children:Object(f.jsx)("div",{className:"d-flex bd-blur shadow text-dark bold text-center justify-content-center align-items-center",style:{height:"320px",width:"180px",fontWeight:"bold"},children:e.que})})})]})};var B=function(){var e=Object(s.useState)(!1),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(!0),i=Object(b.a)(c,2),o=(i[0],i[1],Object(s.useState)([])),g=Object(b.a)(o,2),m=g[0],h=g[1],x=Object(s.useState)([]),O=Object(b.a)(x,2),v=O[0],y=O[1],w=Object(s.useState)(-1),I=Object(b.a)(w,2),k=I[0],R=I[1],S=Object(s.useState)(!1),F=Object(b.a)(S,2),B=F[0],D=F[1],A=Object(s.useState)(!1),U=Object(b.a)(A,2),P=U[0],G=U[1],W=Object(s.useState)(!1),q=Object(b.a)(W,2),T=q[0],z=q[1],J=Object(s.useState)([]),Q=Object(b.a)(J,2),H=Q[0],K=Q[1],V=Object(s.useState)([]),X=Object(b.a)(V,2),Y=X[0],Z=X[1],$=Object(s.useState)(!1),ee=Object(b.a)($,2),te=ee[0],ne=ee[1],se=Object(s.useState)({createDatabase:{label:"Create Database",status:0},uploadReferenceImage:{label:"Upload Reference",status:0},results:{label:"Results",status:0}}),ae=Object(b.a)(se,2),ce=ae[0],ie=ae[1],re=Object(s.useState)("createDatabase"),oe=Object(b.a)(re,2);function le(e){return de.apply(this,arguments)}function de(){return(de=Object(d.a)(l.a.mark((function e(t){var n,s,a,c,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("hiddenCanvas"),s=n.getContext("2d"),a=document.getElementById("hiddenImage"),document.getElementById("hiddenImage2"),c=new FormData,a.src=t,e.next=8,new Promise((function(e){return n.toBlob(e,"image/png")}));case 8:return i=e.sent,c.set("query_image",i,"file2.png"),n.width=180,n.height=320,a.src=v[k],setTimeout((function(){}),100),s.drawImage(a,0,0,180,320),e.next=17,new Promise((function(e){return n.toBlob(e,"image/png")}));case 17:return r=e.sent,c.set("target_image",r,"file1.png"),c.set("key","662b2a0adeb3bbc7388bb274fc735c98648f0c70e6ebde9aebb9b56784f05d33"),a.src=URL.createObjectURL(i),e.abrupt("return",fetch("https://api.skylarklabs.ai/face-recognition/",{method:"POST",body:c}).then((function(e){return e.json()})).then((function(e){return console.log(e),e.id})));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(){return be.apply(this,arguments)}function be(){return(be=Object(d.a)(l.a.mark((function e(){var t,n,s,a,c,i,r,o,d,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=16/9,n=new j.b({minConfidence:.4}),e.next=4,j.c("hiddenImage",n);case 4:s=e.sent,a=[],c=0;case 7:if(!(c<s.length)){e.next=21;break}return i=s[c].box._width,r=s[c].box.height,o=0,d=0,i*t>r?d=i*t-r:r>i*t&&(o=r/t-i),e.next=15,j.d("hiddenImage",[new j.a(s[c].box._x-o/2,s[c].box._y-d/2,s[c].box._width+o,s[c].box._height+d)]);case 15:u=e.sent,s[c].url=u[0].toDataURL(),a.push(u[0].toDataURL());case 18:c++,e.next=7;break;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e,t){return ge.apply(this,arguments)}function ge(){return(ge=Object(d.a)(l.a.mark((function e(t,n){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(!0),document.getElementById("hiddenImage").src=t,e.next=4,ue();case 4:s=e.sent,"database"==n?h([].concat(Object(r.a)(m),Object(r.a)(s))):"reference"==n&&y([].concat(Object(r.a)(v),Object(r.a)(s))),z(!1);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return(me=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(!0),document.getElementById("hiddenImage").src=t,e.next=4,ue();case 4:n=e.sent,B?(h([].concat(Object(r.a)(m),Object(r.a)(n))),D(!1)):P&&(y([].concat(Object(r.a)(v),Object(r.a)(n))),G(!1)),z(!1);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(){return(he=Object(d.a)(l.a.mark((function e(){var t,n,s,a,c,i,r,o,d,u,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=document.getElementById("hiddenCanvas"),n=document.getElementById("hiddenImage2"),s=t.getContext("2d"),a=Math.ceil(Math.sqrt(m.length)),c=1,a>12&&(c=Math.ceil(m.length/144),a=12),t.width=90*a,t.height=160*a,Z([90*a,160*a]),i=[],r=0;case 11:if(!(r<c)){e.next=25;break}for(s.fillStyle="#ffffff",s.fillRect(0,0,90*a,160*a),o=0;o<a*a&&r*a+o<m.length;o++)d=r*a*a+o,n.src=m[d],s.drawImage(n,d%a*90,160*Math.floor(o/a),90,160);return u=t.toDataURL(),e.next=18,new Promise((function(e){return setTimeout(e,1e3)}));case 18:return e.next=20,le(u);case 20:b=e.sent,i.push({img:u,query:b,result:!1,index:r});case 22:r++,e.next=11;break;case 25:K(i);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return oe[0],oe[1],Object(s.useEffect)((function(){if(v.length>0&&-1==k){var e=Object(u.a)({},ce);e.uploadReferenceImage.status=1,ie(e),R(0)}else{var t=Object(u.a)({},ce);t.uploadReferenceImage.status=0,ie(t)}}),[v]),Object(s.useEffect)((function(){if(m.length>0){var e=Object(u.a)({},ce);e.createDatabase.status=1,ie(e)}else{var t=Object(u.a)({},ce);t.createDatabase.status=0,ie(t)}}),[m]),Object(s.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/models",e.next=3,j.e("/models");case 3:a(!0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(s.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){var t,n,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(r.a)(H),n=0;case 2:if(!(n<t.length)){e.next=13;break}if(t[n].result){e.next=10;break}return e.next=6,new Promise((function(e){return setTimeout(e,1e3)}));case 6:return e.next=8,fetch("https://api.skylarklabs.ai/face-recognition/"+t[n].query+"?key=662b2a0adeb3bbc7388bb274fc735c98648f0c70e6ebde9aebb9b56784f05d33",{method:"GET"}).then((function(e){return e.json()})).then((function(e){return console.log(e),e}));case 8:"success"==(s=e.sent).status?(t[n].result=s,t[n].result.json=JSON.parse(t[n].result.response_json),K(t)):"pending"==s.status?K(Object(r.a)(t)):(t[n].result="failed",K(t));case 10:n++,e.next=2;break;case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}H.length>0&&("success"==H[H.length-1].result.status||"failed"==H[H.length-1].result.status)?ie(Object(u.a)(Object(u.a)({},ce),{},{results:Object(u.a)(Object(u.a)({},ce.results),{},{status:1})})):function(){e.apply(this,arguments)}()}),[H]),Object(s.useEffect)((function(){if(1==ce.results.status){for(var e=null,t=0;t<H.length;t++){console.log("here"),console.log(H[t].result.json.recognitions);for(var n=0;n<H[t].result.json.recognitions.length;n++)console.log(H[t].result.json.recognitions[n]),-1!=H[t].result.json.recognitions[n][0]&&(null==e||e.prob<H[t].result.json.recognitions[n][1])&&((e={}).prob=H[t].result.json.recognitions[n][1],e.coordinates=H[t].result.json.query_detections[n].coordinates,e.image=H[t].img)}console.log(e),null!=e&&ne(e)}}),[ce]),console.log(te),console.log(H),Object(f.jsxs)("div",{className:"App ",children:[Object(f.jsx)("div",{id:"webcamBackdrop",className:B||P?"d-block":"d-none",style:{width:window.innerWidth,height:window.innerHeight},children:B||P?Object(f.jsx)(p,{addImage:function(e){return me.apply(this,arguments)},closeWebcam:function(){B&&D(!1),P&&G(!1)},processing:T}):null}),Object(f.jsx)("div",{id:"navbar",className:"shadow bg-dark text-light mb-2",children:"Face Recognition Demo"}),Object(f.jsxs)("div",{className:"row mx-0 col-12",children:[Object(f.jsxs)("div",{id:"databaseGridArea",className:"row mx-0 bg-light px-0",children:[Object(f.jsx)("div",{className:"col-12 text-light "+(0===m.length?"bg-secondary ":"")+(1===m.length?"bg-danger ":"")+(m.length>1?"bg-success ":""),children:"Step 1: Create your database"}),Object(f.jsx)("div",{className:"col-12 px-0",children:Object(f.jsx)(L,{images:m,removeImage:function(e){for(var t=[],n=0;n<m.length;n++)e!=n?t.push(m[n]):URL.revokeObjectURL(m[n]);h(t)}})}),Object(f.jsx)("div",{className:"col-12 d-flex justify-content-center",children:Object(f.jsx)(C,{label:"Import Faces",webcamFunction:D,modelLoaded:n,handleFileInput:je,target:"database"})})]}),Object(f.jsxs)("div",{id:"referenceArea",className:"row mx-0 bg-light px-0",children:[Object(f.jsx)("div",{className:"col-12 text-light bg-secondary",children:"Step 2: Add a reference face"}),Object(f.jsx)(N,{images:v,removeImage:function(e){for(var t=[],n=0;n<v.length;n++)e!=n?t.push(v[n]):URL.revokeObjectURL(v[n]);y(t)},active:k,setActive:R}),Object(f.jsx)("div",{className:"col-12 d-flex justify-content-center pb-2",children:Object(f.jsx)(C,{label:"Import Faces",webcamFunction:G,modelLoaded:n,handleFileInput:je,target:"reference"})})]}),Object(f.jsx)("div",{id:"referenceEntryArea"}),Object(f.jsxs)("div",{id:"resultArea",className:"row mx-0 bg-light px-0",children:[Object(f.jsx)("div",{className:"col-12 text-light bg-secondary",children:"Results"}),Object(f.jsx)("div",{className:"col-12 bg-light text-center text-success ",children:"Result updates here"}),Object(f.jsxs)("div",{className:"row mx-0 col-12 bg-light",children:[Object(f.jsx)("div",{className:"col-4 d-flex mx-0 justify-content-center",children:Object(f.jsx)(E,{images:v,index:k,label:"Reference Image",que:"Reference Image Will be displayed here"})}),Object(f.jsx)("div",{className:"col-4 d-flex justify-content-center align-items-center",children:Object(f.jsx)(_,{progressStatus:ce,startQuery:function(){!function(){he.apply(this,arguments)}()},foundFace:te,inProgress:T})}),Object(f.jsxs)("div",{className:"col-4 d-flex mx-0 justify-content-center",children:[" ",Object(f.jsx)(M,{image:te,label:"Mached Image",que:"Images Matched Will be displayed here",localDimensions:Y,faces:m})]})]})]})]}),Object(f.jsx)("img",{id:"hiddenImage",style:{display:"none"},src:""}),Object(f.jsx)("img",{id:"hiddenImage2",style:{display:"none"},src:""}),Object(f.jsx)("canvas",{id:"hiddenCanvas",style:{display:"none"}}),Object(f.jsx)("canvas",{id:"hiddenCanvas2",style:{display:"none"}})]})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,76)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),s(e),a(e),c(e),i(e)}))};i.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(B,{})}),document.getElementById("root")),D()}},[[59,1,2]]]);
//# sourceMappingURL=main.87eb1053.chunk.js.map